# **Storage**

## **Web Storage**

1. 클라이언트에 데이터를 저장할 수 있도록 지원하는 HTML5의 새로운 기능.
2. 종류로는 **local storage**, **session storage**가 있음.
3. 둘다 key - value 형식으로 데이터를 저장함.(문자)
4. 자바스크립트에서 접근이 가능함.ex> window 객체를 통해 접근가능함.  
   (같은 Storage 객체를 상속받아서 같은 메소드를 사용할 수 있음)
5. 기본적으로 프로토콜, 호스트, 포트가 같으면 같은 스토리지를 공유함.
6. 용량은 기기별, 브라우저별로 다르지만 모바일은 2.5mb, 데스크탑은 5mb~10mb정도 됨.

### **Local Storage**

1. 데이터의 만료기간이 없음.(영구성)
2. 같은 도메인이면 저장소 데이터에 접근 가능함.(공유)

### **Session Storage**

1. 세션스토리지의 데이터는 브라우저 탭이나 윈도우를 닫을 경우 제거됨.  
   (일회성 로그인정보 저장용이)
2. 같은 도메인이더라도 세션(ex>브라우저 탭)이 다르면 저장소 데이터에 접근할 수 없음.

<br>

---

<br>

## **Cookie**

1. 작은 기록 정보 파일.(4kb 제한있음)
2. 만료기간이 있는 key - value 저장소임.
3. 클라이언트에서 서버로 요청을 보낼때 정보를 담아서 보내는 용도.(내가 누구인지)

### **Kind of**

| cookie             | summary                                                                                             |
| ------------------ | --------------------------------------------------------------------------------------------------- |
| session cookie     | 만료시간을 설정하고 브라우저 종료시 쿠키를 삭제                                                     |
| persistent cookie  | 장기간 유지되는 쿠키.(기간 설정) <br> 파일로 저장되어 브라우저 종료와는 무관하게 사용               |
| secure cookie      | https에서만 사용, 쿠키정보가 암호화되어 전송                                                        |
| third-party cookie | 방문한 도메인과 다른 도메인의 쿠키. <br> 보통 광고 배너등을 관리할 때 유입경로를 추척하기 위해 사용 |

<br>

|                Flow                 |
| :---------------------------------: |
|        (client) HTTP request        |
|                  ▼                  |
| (server) HTTP response + Set-Cookie |
|                  ▼                  |
|   (client) HTTP request + Cookie    |
|                  ▼                  |
|       (server) HTTP response        |

<br>

### **Set-Cookie**

1. 서버에서 클라이언트한테 "~이런 쿠키를 저장해"라고 명령하는 응답 헤더임.
2. key=value 형태로 입력함. ex> hello=juno

- 옵션s

  ```
  ▫ Expires: 쿠키 만료 날짜를 알려줄 수 있음.
  ▫ Max-Age: 쿠키 수명을 알려줄 수 있음.(Expires는 무시)
  ▫ Secure: https에서만 쿠키가 전송되게 설정.
  ▫ Path: 패스를 적어주면 이 패스와 일치하는 요청에서만 쿠키가 전송됨.
  ▫ HttpOnly: 자바스크립트에서 쿠키에 접근할 수 없게함.
    (XSS 요청을 막으려면 활성화해두는 것이 좋음)
  ▫ Domain: 도메인을 적어주면 도메인이 일치하는 요청에서만 쿠키가 전송됨.
    (가끔 도메인이 다른 쿠키들이 있는데, 이런 쿠키들은 써드 파티 쿠키로 여러분을 추적하고 있는 쿠키임)
  ```

  ex>
  `Set-Cookie: hello=juno; Expires=Thurs, 22 Jul 2021 10:30:00 GMT; Secure; HttpOnly`

<br>

---

<br>

## **Session**

1. 데이터를 클라이언트가 아닌 접속한 서버 DB에 저장함.
2. 클라이언트는 HTTP session id를 쿠키에 저장함.
3. 위 id를 메모리에 저장하기 때문에 브라우저가 종료되면 삭제됨.
4. object형태로 저장됨.
5. 쿠키의 **트래픽문제, 쿠키를 변경하는 보안적 이슈**를 해결하기 위해 등장함.

<br>

|                      Flow                      |
| :--------------------------------------------: |
|             (client) HTTP request              |
|                       ▼                        |
| (server) HTTP response + Set-Cookie(sessionId) |
|                       ▼                        |
|   (client) HTTP request + Cookie(sessionId)    |
|                       ▼                        |
|             (server) HTTP response             |

<br>

---

<br>

## **Cookie vs LocalStorage**

1. 쿠키는 만료기한이 있지만 로컬스토리지는 사용자가 지우지 않는 한 영구적임.
2. 쿠키는 서버에 매 요청시마다 자동으로 보내짐.
3. 둘다 자바스크립트로 접근 가능하지만, 쿠키는 옵션으로 접근제한을 걸어둘 수 있음.
4. 쿠키는 4kb까지, 로컬스토리지는 5~10mb까지 저장 가능함.
5. 데이터낭비(트래픽)를 피하기 위해 서버에 필요없는 데이터는 웹 스토리지에 저장, 필요한 데이터는 쿠키에 저장함.
